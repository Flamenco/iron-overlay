<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="iron-overlay-renderer.html">
<link rel="import" href="iron-animated-overlay-renderer-shared-styles.html">

<!--
@demo demo/index.html
-->

<dom-module id="iron-animated-overlay-renderer">
  <template strip-whitespace>
    <style include="iron-animated-overlay-renderer-shared-styles"></style>
    <div id="backdrop"></div>
    <div id="overlay" tabindex="0">
      <slot></slot>
    </div>
  </template>

  <script>
    (function() {
      'use strict';

      const _onTransitionEnd = Symbol();

      class IronAnimatedOverlayRenderer extends Polymer.IronOverlayRenderer {
        static get is() {
          return 'iron-animated-overlay-renderer';
        }

        static get config() {
          return {
            properties: {
              withBackdrop: {
                type: Boolean,
                reflectToAttribute: true
              }
            }
          };
        }

        ready() {
          super.ready();
          this.$.overlay.addEventListener('transitionend', this[_onTransitionEnd].bind(this));
        }

        /**
         * Override this, as we need to wait for animation to complete.
         * @protected
         */
        _renderOpenedChanged() {
          this.classList.toggle('opened', this.opened);
        }

        /**
         * Ends the animation.
         */
        [_onTransitionEnd](event) {
          if (event.target === this.$.overlay) {
            this._finishRenderOpenedChanged();
          }
        }
      }

      Polymer.IronAnimatedOverlayRenderer = IronAnimatedOverlayRenderer;
      customElements.define(IronAnimatedOverlayRenderer.is, IronAnimatedOverlayRenderer);
    })();
  </script>
</dom-module>
